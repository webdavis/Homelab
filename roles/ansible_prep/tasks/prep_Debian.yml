---
- name: Initial system upgrades
  block:
    - name: Update the apt cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600
        force_apt_get: true
      tags: ['update']

    - name: Upgrade all packages
      ansible.builtin.apt:
        upgrade: "{{ ansible_prep_upgrade_type }}"
        force_apt_get: true
      tags: ['upgrade']
  rescue:
    - name: "Debug: error during initial system upgrade"
      ansible.builtin.debug:
        msg: "An error occurred during the initial system upgrade."

- name: Install Ansible dependencies
  block:
    - name: Ensure Python 3 is installed (required for Ansible)
      ansible.builtin.package:
        name: python3
        state: present
      tags: ['python3']

    - name: Ensure libc-bin is installed (required for core system utilities)
      ansible.builtin.package:
        name: libc-bin
        state: present
      tags: ['libc']

    - name: Ensure ACL is installed (needed for advanced filesystem management)
      ansible.builtin.package:
        name: acl
        state: present
      tags: ['acl']
  rescue:
    - name: "Debug: error while install Ansible dependencies"
      ansible.builtin.debug:
        msg: "An error occurred while installing Ansible dependencies."
